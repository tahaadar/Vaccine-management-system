\chapter{Depuração de programas}
\hypertarget{md_debugging}{}\label{md_debugging}\index{Depuração de programas@{Depuração de programas}}
\label{md_debugging_autotoc_md0}%
\Hypertarget{md_debugging_autotoc_md0}%


Existem várias ferramentas e métodos que permitem depurar programas. A dica geral é identificar o menor subconjunto possível do input que continua causar o {\itshape bug}. Apresentamos aqui algumas recomendações.

Para correr um teste particular, usem o comando seguinte. \begin{DoxyVerb}./proj < tests/teste01.in
\end{DoxyVerb}


onde {\ttfamily proj} é o vosso programa compilado e {\ttfamily tests/teste01.\+in} é o input que querem testar.\hypertarget{md_debugging_autotoc_md1}{}\doxysection{\texorpdfstring{Erros e Warnings (avisos)}{Erros e Warnings (avisos)}}\label{md_debugging_autotoc_md1}
Prestem atenção aos erros e warnings que o vosso programa apresenta aquando da compilação. As mensagens costumam ser relativamente explicitas. Quando não o forem, se googlarem o erro/warning apresentado poderão quase sempre identificar o problema em causa.\hypertarget{md_debugging_autotoc_md2}{}\doxysection{\texorpdfstring{Quando o programa dá output errado}{Quando o programa dá output errado}}\label{md_debugging_autotoc_md2}
O resultado do teste acima encontra-\/se no ficheiro {\ttfamily tests/teste01.\+out}.

O programa {\ttfamily diff} pode ser usado para comparar os dois outputs (existem outras ferramentas com interface gráfica) \begin{DoxyVerb}./proj < tests/teste01.in > myoutput.out
diff myoutput.out tests/teste01.out
\end{DoxyVerb}


apresentando as diferenças entre os dois ficheiros. Se quiserem entender em detalhe o output do {\ttfamily diff} podem por exemplo ver \href{https://unix.stackexchange.com/questions/81998/understanding-of-diff-output}{\texttt{ aqui}}.

Podem também instalar a ferramenta {\ttfamily icdiff} (Ubuntu\+: {\ttfamily sudo apt install icdiff}). \begin{DoxyVerb} icdiff myoutput.out tests/teste01.out | less -R
\end{DoxyVerb}
\hypertarget{md_debugging_autotoc_md3}{}\doxysection{\texorpdfstring{Quando o programa rebenta}{Quando o programa rebenta}}\label{md_debugging_autotoc_md3}
Se um programa rebentar, a ferramenta {\ttfamily valgrind} ou a opção {\ttfamily -\/fsanitize} podem ser usadas para encontrar a razão.

Para além destas ferramentas, também existe a ferramenta {\ttfamily cppcheck}, que tenta encontrar pedaços de código que podem ser fontes de erro. É um tipo de ferramenta que pode apresentar {\itshape false positives}, o que quer dizer que pode apontar erros que de facto não o são.\hypertarget{md_debugging_autotoc_md4}{}\doxysection{\texorpdfstring{Opção {\ttfamily fsanitize}}{Opção {\ttfamily fsanitize}}}\label{md_debugging_autotoc_md4}
A opção {\ttfamily fsanitize} invoca uma ferramenta {\ttfamily Address\+Sanitizer} útil para analisar o projecto, em particular erros de memória.

Para analisar um teste que está a falhar, deverá efetuar os seguintes passos\+:


\begin{DoxyEnumerate}
\item Compilar com as flags {\ttfamily -\/g -\/fsanitize=address}, e.\+g. {\ttfamily gcc -\/g -\/fsanitize=address -\/Wall -\/Wextra -\/Werror -\/Wno-\/unused-\/result -\/o proj proj.\+c}.
\item executar o projecto compilado usando o teste que está a falhar como standard input, e.\+g. \begin{DoxyVerb} $ ./proj < tests/teste27.in
\end{DoxyVerb}

\end{DoxyEnumerate}

Podem também ignorar o output do projecto por forma a ver só os erros da seguinte forma\+: \begin{DoxyVerb} $ ./proj < tests/teste27.in > /dev/null
\end{DoxyVerb}
\hypertarget{md_debugging_autotoc_md5}{}\doxysection{\texorpdfstring{Valgrind}{Valgrind}}\label{md_debugging_autotoc_md5}
É aconselhável analisar o projecto usando também a ferramenta Valgrind. Para instalar no Ubuntu\+: \begin{DoxyVerb}$ sudo apt install valgrind
\end{DoxyVerb}


Para analisar com o {\ttfamily valgrind} um teste que está a falhar, deverá efectuar os seguintes passos\+:


\begin{DoxyEnumerate}
\item Compilar com a flag {\ttfamily -\/g}, e.\+g. {\ttfamily gcc -\/g -\/Wall -\/Wextra -\/Werror -\/Wno-\/unused-\/result -\/o proj proj.\+c}.
\item executar o projecto compilado com o Valgrind usando o teste que está a falhar como standard input, e.\+g. \begin{DoxyVerb} $ valgrind ./proj < tests/teste27.in
\end{DoxyVerb}

\end{DoxyEnumerate}

Podem também ignorar o output do projecto por forma a ver só os erros da seguinte forma\+: \begin{DoxyVerb} $ valgrind ./proj < tests/teste27.in > /dev/null
\end{DoxyVerb}


{\itshape Nota\+:} O valgrind neste momento não tem suporte completo para Macs. Vejam a FAQ sobre como instalar a aplicação leaks (o equivalent do valgrind para Mac). Outras alternativas são utilizar uma máquina virtual com ubuntu, os computadores dos laboratórios, ou pedir ajuda a um colega/amigo.\hypertarget{md_debugging_autotoc_md6}{}\doxysection{\texorpdfstring{cppcheck}{cppcheck}}\label{md_debugging_autotoc_md6}
É aconselhável analisar o projecto usando também a ferramenta {\ttfamily cppcheck}. Para instalar no Ubuntu\+: \begin{DoxyVerb}$ sudo apt install cppcheck
\end{DoxyVerb}


Para analisar o projecto usando esta ferramenta deverá executar\+: \begin{DoxyVerb}$ cppcheck --enable=all --language=c proj.c
\end{DoxyVerb}


ou, para mais informações\+: \begin{DoxyVerb}$ cppcheck --enable=all --language=c -v proj.c
\end{DoxyVerb}
 